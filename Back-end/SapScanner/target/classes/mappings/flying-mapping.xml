<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="FlyingDAO">

	<!-- 항공 스케쥴 입력 resultMap -->
	<resultMap id="scheduleResult" type="flying">
		<id property="vihicleId" column="VIHICLE_ID"/>
		<result property="airlineNm" column="AIRLINE_NM"/>
		<result property="depAirportId" column="DEP_AIRPORT_ID"/>
		<result property="depAirportNm" column="DEP_AIRPORT_NM"/>
		<result property="depCityNm" column="DEP_CITY_NM"/>
		<result property="depPlandTime" column="DEP_PLAND_TIME"/>
		<result property="arrAirportId" column="ARR_AIRPORT_ID"/>
		<result property="arrAirportNm" column="ARR_AIRPORT_NM"/>
		<result property="arrCityNm" column="ARR_CITY_NM"/>
		<result property="arrPlandTime" column="ARR_PLAND_TIME"/>
		<result property="economyCharge" column="ECONOMY_CHARGE"/>
		<result property="prestigeCharge" column="PRESTIGE_CHARGE"/>
		<result property="firstCharge" column="FIRST_CHARGE"/>
	</resultMap>

	<!-- 항공권 스케쥴 입력 -->
	<insert id="insertSchedule" parameterType="flying">
      <![CDATA[
            INSERT INTO FLIGHT_SCHEDULE(VIHICLE_ID, AIRLINE_NM, DEP_AIRPORT_ID, 
            DEP_AIRPORT_NM, DEP_CITY_NM, DEP_PLAND_TIME, ARR_AIRPORT_ID, ARR_AIRPORT_NM, 
            ARR_CITY_NM, ARR_PLAND_TIME, ECONOMY_CHARGE, PRESTIGE_CHARGE, FIRST_CHARGE)
            VALUES(#{vihicleId}, #{airlineNm}, #{depAirportId}, #{depAirportNm},
            #{depCityNm}, #{depPlandTime}, #{arrAirportId}, #{arrAirportNm},
            #{arrCityNm}, #{arrPlandTime}, #{economyCharge}, #{prestigeCharge},
            #{firstCharge})      
      ]]>
	</insert>
	
	<!-- 항공권 스케쥴 수정 -->
	<update id="updateSchedule" parameterType="flying">
	  <![CDATA[
	  		UPDATE FLIGHT_SCHEDULE
	  		SET AIRLINE_NM = #{airlineNm}, DEP_AIRPORT_ID = #{depAirportId}, DEP_AIRPORT_NM = #{depAirportNm},
	  			DEP_CITY_NM = #{depCityNm}, DEP_PLAND_TIME = #{depPlandTime}, ARR_AIRPORT_ID = #{arrAirportId},
	  			ARR_AIRPORT_NM = #{arrAirportNm}, ARR_CITY_NM = #{arrCityNm}, ARR_PLAND_TIME = #{arrPlandTime},
	  			ECONOMY_CHARGE = #{economyCharge}, PRESTIGE_CHARGE = #{prestigeCharge}, FIRST_CHARGE = {firstCharge}
	  		WHERE VIHICLE_ID = #{vihicleId}
	  ]]>
	</update>
	
	<!-- 항공권 스케쥴 삭제 -->
	<delete id="deleteSchedule" parameterType="flying">
	<![CDATA[
	  		DELETE FLIGHT_SCHEDULE
      		WHERE VIHICLE_ID = #{vihicleId}
	  ]]>
	</delete>
	
	<!-- 편도 검색 조건 입력 후 출력 -->
	<select id="getSingleSchedule" resultType="flying">
      <![CDATA[
      SELECT * FROM FLIGHT_SCHEDULE 
      WHERE 1=1
      ]]>
      <if test="depCityAirportNm != null and depCityAirportNm != ''">
      	AND DEP_CITY_NM LIKE '%' || #{depCityAirportNm}|| '%'
      	OR DEP_AIRPORT_NM LIKE '%' || #{depCityAirportNm}|| '%'
      </if>
      <if test="arrCityAirportNm != null and arrCityAirportNm != ''">
      	AND ARR_CITY_NM LIKE '%' || #{arrCityAirportNm}|| '%'
      	OR ARR_AIRPORT_NM LIKE '%' || #{arrCityAirportNm}|| '%'
      </if>
      <if test="depPlandTime != null and depPlandTime != ''">
      	AND DEP_PLAND_TIME LIKE '%' || #{depPlandTime} || '%'
      </if>
      <![CDATA[ 
      UNION
      INSERT INTO FLIGHT_SEAT
      WHERE 1=1
      ]]>
      <if test="seatGrade != null and seatGrade != ''">
      	AND SEAT_GRADE LIKE '%' || #{seatGrade}|| '%'
      </if> 
      <![CDATA[ 
      ORDER BY economyCharge DESC;
      ]]>
	</select>
	
	<!-- 왕복 검색 조건 입력 후 출력 -->
	<select id="getDoubleSchedule" resultType="flying">
       <![CDATA[
      SELECT * FROM FLIGHT_SCHEDULE 
      WHERE 1=1
      ]]>
      <if test="depCityAirportNm != null and depCityAirportNm != ''">
      	AND DEP_CITY_NM LIKE '%' || #{depCityAirportNm}|| '%'
      	OR DEP_AIRPORT_NM LIKE '%' || #{depCityAirportNm}|| '%'
      </if>
      <if test="arrCityAirportNm != null and arrCityAirportNm != ''">
      	AND ARR_CITY_NM LIKE '%' || #{arrCityAirportNm}|| '%'
      	OR ARR_AIRPORT_NM LIKE '%' || #{arrCityAirportNm}|| '%'
      </if>
      <if test="depPlandTime != null and depPlandTime != ''">
      	AND DEP_PLAND_TIME LIKE '%' || #{depPlandTime} || '%'
      </if>
      <![CDATA[ 
      UNION
      INSERT INTO FLIGHT_SEAT
      WHERE 1=1
      ]]>
      <if test="seatGrade != null and seatGrade != ''">
      	AND SEAT_GRADE LIKE '%' || #{seatGrade}|| '%'
      </if> 
      <![CDATA[ 
      ORDER BY economyCharge DESC;
      ]]>
	</select>
</mapper>